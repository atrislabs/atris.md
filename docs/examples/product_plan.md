# Human Layer Plan â€” Complete Workflow Examples

This document contains detailed human layer examples for three types of work:
1. New Feature (Complex, Multi-step)
2. Bug Fix (Simple, Targeted)
3. Enhancement (Medium, Iterative)

These are meant to be worked through by humans (product managers, engineers, stakeholders) and then passed to an agent to convert into the technical agent layer.

---

## Example 1: Bidirectional Journal Sync (Feature)

### Human Layer

```markdown
## Web Dashboard Journal Sync

so we have journal files locally in atris/logs/.
and we're building a web dashboard that should show the same journal.

the tricky part is keeping them in sync both ways.
if i edit on the web, it syncs to cli. if i edit in cli, it syncs to web.

but what if there's a conflict? like i edit both at the same time?

maybe we check timestamps? newer one wins?

or like, show the conflict and let human decide?

also security - we need to make sure only the right user can sync their journal.
token based maybe? or OAuth with their atris account?

and what about offline? if i'm on a plane and edit locally,
it should queue up and sync when i'm back online.

also need to track what's been synced so we don't duplicate stuff.
state file maybe? or metadata in the markdown itself?
```

### Parser Output (ASCII) â€” Human Confirms

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BIDIRECTIONAL JOURNAL SYNC            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LOCAL (CLI)      â†”  WEB (Dashboard)   â”‚
â”‚                                       â”‚
â”‚ Sync triggers:                        â”‚
â”‚ â€¢ User saves on web  â†’ push to CLI    â”‚
â”‚ â€¢ User logs in CLI   â†’ pull from web  â”‚
â”‚                                       â”‚
â”‚ Conflict handling:                    â”‚
â”‚ â€¢ Timestamps: newer wins              â”‚
â”‚ â€¢ Show conflict if simultaneous edit  â”‚
â”‚                                       â”‚
â”‚ Auth:                                 â”‚
â”‚ â€¢ Token-based (user's atris account)  â”‚
â”‚                                       â”‚
â”‚ Offline:                              â”‚
â”‚ â€¢ Queue edits locally                 â”‚
â”‚ â€¢ Sync when online                    â”‚
â”‚                                       â”‚
â”‚ State tracking:                       â”‚
â”‚ â€¢ Metadata file (.sync_state.json)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Syncs journal between CLI and web. Newer version wins on conflicts.
Uses token auth. Queues offline changes. Tracks sync state in metadata file.

Correct? (y/n)
```

**Human confirms: YES**

### Agent Layer (Generated by Agent)

```markdown
## bidirectional_journal_sync

files_touched:
  - commands/log-sync.js (new file)
  - lib/sync-engine.js (new file)
  - ~/.atris/.sync_state.json (metadata)
  - bin/atris.js (add sync trigger to log command)

input: user action (edit on web OR edit in CLI)
output: synchronized journal state (both sides match)

preconditions:
  - user authenticated (valid token in ~/.atris/credentials.json)
  - journal files exist locally
  - network available (or queue locally)

architecture:
  1. Detect sync trigger (web save OR cli exit)
  2. Check .sync_state.json for last sync timestamp
  3. Fetch latest from server
  4. Compare timestamps (local vs remote)
  5. If conflict â†’ show ASCII prompt, human picks
  6. Merge selected version
  7. Update .sync_state.json with new timestamp
  8. If offline â†’ queue in memory, sync on reconnect

steps:
  1. Create sync-engine.js with conflict detection logic
  2. Create log-sync.js command for manual/auto sync
  3. Add token refresh logic to handle expired auth
  4. Add sync trigger to log command exit
  5. Create .sync_state.json metadata file
  6. Add error handling for network failures
  7. Add offline queue persistence
  8. Test with simultaneous edits

error_cases:
  - token expired â†’ refresh or prompt re-login
  - network down â†’ queue locally, retry on reconnect
  - simultaneous edits â†’ show conflict, human chooses
  - corrupted state file â†’ reset and resync
  - permission denied â†’ 401, guide to login

side_effects:
  - Creates new files (log-sync.js, sync-engine.js)
  - Modifies bin/atris.js (add sync hook)
  - Creates/updates .sync_state.json
  - Network calls to sync server
```

### Execution Flow (Agent Shows One Step at a Time)

**Step 1/8:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SYNC SETUP â€” Step 1/8               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Creating sync-engine.js             â”‚
â”‚                                     â”‚
â”‚ â€¢ Conflict detection logic          â”‚
â”‚ â€¢ Timestamp comparison              â”‚
â”‚ â€¢ Merge strategy                    â”‚
â”‚                                     â”‚
â”‚ Status: Writing... âœ“ Done           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Created sync-engine.js with conflict detection and merge logic.
Ready for step 2? (y/n)
```

(Steps 2-7 continue similarly, one ASCII at a time)

**Step 8/8 (Final):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SYNC SETUP â€” Complete âœ“             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Files created:    3                 â”‚
â”‚ Files modified:   1                 â”‚
â”‚ Tests added:      8                 â”‚
â”‚ All tests pass:   âœ“                 â”‚
â”‚                                     â”‚
â”‚ Ready to review & merge             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Bidirectional sync is live. All tests passing. No breaking changes detected.
Ready to ship? (y/n)
```

---

## Example 2: Fix Timezone Bug (Bug Fix)

### Human Layer

```markdown
## Fix Timezone Bug in Analytics

so i noticed the analytics command is showing UTC dates
but the user's journal is in their local timezone.

so if i logged something today at 11pm, but it's after midnight UTC,
the analytics shows it as tomorrow. super confusing.

should be easy fix right? just use local timezone everywhere?

check the analytics command and wherever we calculate dates.
make sure it's consistent with what shows in the journal.

also maybe add a comment explaining why we use local time.
for future devs.
```

### Parser Output (ASCII) â€” Human Confirms

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX TIMEZONE BUG                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Problem:                          â”‚
â”‚ â€¢ Analytics uses UTC              â”‚
â”‚ â€¢ Journal uses local timezone     â”‚
â”‚ â€¢ Mismatch confuses users         â”‚
â”‚                                   â”‚
â”‚ Solution:                         â”‚
â”‚ â€¢ Use local timezone everywhere   â”‚
â”‚ â€¢ Add explanatory comments        â”‚
â”‚ â€¢ Keep journal + analytics in syncâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Analytics showing UTC dates when journal is local time.
Fix by switching to local timezone in date calculations everywhere.
Add comments for future devs. Correct? (y/n)
```

**Human confirms: YES**

### Agent Layer (Generated by Agent)

```markdown
## fix_timezone_bug

problem: Analytics command uses UTC, journal uses local timezone
impact: Date mismatch causes confusion (log today, shows tomorrow in analytics)
severity: Medium (affects reporting accuracy)

files_to_check:
  - commands/analytics.js (date calculations)
  - lib/file-ops.js (getLogPath function)
  - bin/atris.js (any date handling)

steps:
  1. Identify all Date objects using UTC
  2. Replace with local timezone equivalents
  3. Add comments explaining timezone strategy
  4. Test with edge case (11pm local = next day UTC)
  5. Verify analytics matches journal dates
  6. Update MAP.md if any functions changed

specific_changes:
  - commands/analytics.js: Change new Date().toISOString() â†’ toLocaleDateString()
  - lib/file-ops.js: Verify getLogPath uses local timezone (it should)
  - Add comment block explaining timezone strategy

tests:
  - Run analytics at 11:55pm local (near UTC boundary)
  - Verify dates match journal entries
  - Check timezone consistency across commands

error_cases:
  - Different timezones on CI â†’ use user's local timezone, not system
  - Daylight saving transitions â†’ JavaScript handles automatically
```

### Execution Flow (Agent Shows One Step at a Time)

**Step 1/4:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX TIMEZONE â€” Step 1/4             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Scanning commands/analytics.js      â”‚
â”‚                                     â”‚
â”‚ Found:                              â”‚
â”‚ â€¢ 3 UTC date uses                   â”‚
â”‚ â€¢ 1 needs fixing                    â”‚
â”‚                                     â”‚
â”‚ Status: Identified âœ“               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Found 3 date calculations in analytics. One uses UTC (line 67).
Ready to fix? (y/n)
```

**Step 2/4:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX TIMEZONE â€” Step 2/4             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Fixing commands/analytics.js:67     â”‚
â”‚                                     â”‚
â”‚ Before: new Date().toISOString()    â”‚
â”‚ After:  new Date().toLocaleDateStr()â”‚
â”‚                                     â”‚
â”‚ Status: Fixed âœ“                    â”‚
â”‚ Added comment block explaining why  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fixed line 67 in analytics.js. Changed to local timezone.
Added comment explaining the strategy. Ready for step 3? (y/n)
```

**Step 3/4:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX TIMEZONE â€” Step 3/4             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Running tests...                    â”‚
â”‚                                     â”‚
â”‚ âœ“ Analytics date matches journal    â”‚
â”‚ âœ“ Edge case (11:55pm) passes        â”‚
â”‚ âœ“ All 5 tests pass                  â”‚
â”‚ âœ“ No type errors                    â”‚
â”‚                                     â”‚
â”‚ Status: Tests pass âœ“               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

All tests passing. Timezone now consistent. Ready for final step? (y/n)
```

**Step 4/4 (Final):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIX TIMEZONE â€” Complete âœ“           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Files modified:    1                â”‚
â”‚ Lines changed:     2                â”‚
â”‚ Comments added:    1                â”‚
â”‚ Tests passing:     5/5 âœ“            â”‚
â”‚ Breaking changes:  None             â”‚
â”‚                                     â”‚
â”‚ Ready to ship                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Bug fixed. Analytics and journal now use same timezone.
Comment explains strategy for future devs. All tests green.
Ship it? (y/n)
```

---

## Example 3: Add ASCII-First Output to Status Command (Enhancement)

### Human Layer

```markdown
## Make Status Command Output ASCII-First

right now `atris status` just dumps text.
should show a nice box at the top with the key numbers.
then explain what it all means.

show inbox count, backlog count, in progress count, completed today count.

maybe add some emojis or symbols to make it feel alive.
but keep it clean, not over the top.

also if inbox is getting big (like 7+ items), add a warning.
and if they completed stuff today, celebrate a little.

one box, 3-4 sentences, done.
```

### Parser Output (ASCII) â€” Human Confirms

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENHANCE STATUS OUTPUT            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Add ASCII box showing:           â”‚
â”‚ â€¢ Inbox count (warn if 7+)       â”‚
â”‚ â€¢ Backlog count                  â”‚
â”‚ â€¢ In Progress count              â”‚
â”‚ â€¢ Completed today count          â”‚
â”‚                                  â”‚
â”‚ Tone:                            â”‚
â”‚ â€¢ Clean, not over-decorated      â”‚
â”‚ â€¢ Celebrate completions          â”‚
â”‚ â€¢ Warning emoji for inbox backup â”‚
â”‚                                  â”‚
â”‚ Format: 1 box + 3-4 sentences    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Status command shows ASCII box with key metrics. Warns if inbox backs up.
Celebrates completions. 3-4 sentence explanation. Clean, not overdone.
Correct? (y/n)
```

**Human confirms: YES**

### Agent Layer (Generated by Agent)

```markdown
## enhance_status_output_ascii

input: today's journal state (inbox, backlog, in progress, completed counts)
output: ASCII box + 3-4 sentence explanation

preconditions:
  - journal file exists
  - sections parseable (## Inbox, ## Backlog, etc)

steps:
  1. Read today's journal file
  2. Count items in each section (Inbox, Backlog, In Progress, Completed)
  3. Build ASCII box with counts
  4. Add warnings (ğŸ“Œ if inbox >= 7)
  5. Add celebration (ğŸ‰ if completed > 0)
  6. Generate 3-4 sentence summary
  7. Display and exit

ascii_box_format:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ TODAY'S STATE   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Inbox: N        â”‚
  â”‚ Backlog: N      â”‚
  â”‚ In Progress: N  â”‚
  â”‚ Completed: N    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

summary_tone:
  - Matter-of-fact (what's happening)
  - Encouraging (celebrate progress)
  - Actionable (suggest next step if needed)

error_cases:
  - no journal file â†’ "No activity yet. Run 'atris log' to start"
  - parse error â†’ show counts as 0, no crash
```

### Execution Flow (Agent Shows One Step at a Time)

**Step 1/2:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENHANCE STATUS â€” Step 1/2           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Updating commands/status.js         â”‚
â”‚                                     â”‚
â”‚ â€¢ Added ASCII box renderer          â”‚
â”‚ â€¢ Added section counters            â”‚
â”‚ â€¢ Added warnings + celebrations     â”‚
â”‚                                     â”‚
â”‚ Status: Complete âœ“                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Updated status command to show ASCII box with key metrics.
Ready for step 2? (y/n)
```

**Step 2/2 (Final):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENHANCE STATUS â€” Complete âœ“         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Files modified:    1                â”‚
â”‚ Lines added:       15               â”‚
â”‚ Tests added:       3                â”‚
â”‚ All tests pass:    âœ“                â”‚
â”‚                                     â”‚
â”‚ Ready to ship                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Status command now shows ASCII box first, then summary.
Tests cover inbox warning, celebration, empty state. All green.
Ship it? (y/n)
```

---

## How to Use This Document

**For Humans:**
- Pick a feature, bug, or enhancement you want to work on
- Write your messy thoughts in the Human Layer section
- Paste to an agent with: "Convert this human layer to an agent layer"

**For Agents:**
- Read the human layer
- Create an ASCII confirmation (parser output)
- Generate the technical agent layer
- Execute step by step, one ASCII at a time

**The Flow:**
1. Human writes messy layer
2. Agent shows ASCII confirmation
3. Human approves
4. Agent generates clean agent layer (silently)
5. Agent executes one step at a time
6. Each step shows ASCII + confirmation
7. Final ASCII summary
8. Human approves to ship

---

**Status:** Framework complete. Ready to be used in practice.
