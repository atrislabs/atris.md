# GEMINI.md

This file provides guidance to Google Gemini when working with code in this repository.

## Using ATRIS (If atris/ folder exists)

**You are in an ATRIS-managed project.** Follow this workflow:

1. **Before any change:** Read `atris/MAP.md` to find relevant files/components
2. **When starting a task:** Check `atris/TASK_CONTEXTS.md` for existing tasks or add new one
3. **After completing task:** Delete task from TASK_CONTEXTS.md
4. **If architecture changes:** Update `atris/MAP.md` with new structure
5. **Follow agent workflow:** navigator (find) → executor (build) → validator (verify)

**Key files:**
- `atris/MAP.md` - Navigation guide (where is X?)
- `atris/TASK_CONTEXTS.md` - Active tasks (delete when done)
- `atris/agent_team/*.md` - Agent specs for reference

## Project Overview

**ATRIS** is a universal system instrumentation tool for AI agents. It's a Node.js CLI package that transforms any codebase into a self-documenting, AI-navigable workspace by scaffolding a structured folder system with navigation guides and agent specifications.

**Core Concept**: Drop `atris.md` into any project → Run `atris init` → AI agents read the spec → System becomes fully instrumented with MAP.md, agent specs, and task contexts in under 10 minutes.

## Architecture

### Entry Point
- `bin/atris.js` - CLI entry point (executable Node.js script)
  - Handles two commands: `init` and `sync`
  - No external dependencies beyond Node.js core modules (fs, path)

### File Structure Generated by ATRIS
When `atris init` runs, it creates:
```
atris/
├── atris.md              (blueprint spec - copied from package)
├── MAP.md                (navigation guide - populated by AI agents)
├── TASK_CONTEXTS.md      (task bank - populated by AI agents)
└── agent_team/
    ├── navigator.md      (system navigator spec)
    ├── executor.md       (task executor spec)
    └── validator.md      (quality gatekeeper spec)
```

### Core Philosophy (from atris.md spec)
1. **MAP.md = Single Source of Truth** - All agents reference one navigation guide with file:line precision
2. **Exact Context** - Every reference includes file:line ranges (e.g., `auth.ts:15-45`)
3. **Self-Validating** - Validator agent keeps artifacts fresh automatically
4. **Universal Application** - Works for code, product, sales, research - any system
5. **Zero Ramp-up** - New agents read MAP.md and are immediately productive

## Development Commands

### Installation & Setup
```bash
# Install dependencies (currently none beyond Node.js built-ins)
npm install

# Link locally for testing
npm link

# Test CLI globally after linking
atris
atris init
atris sync
```

### Testing the CLI
```bash
# Test init command (creates atris/ folder structure)
cd /path/to/test/project
atris init

# Test sync command (updates atris.md to latest version)
atris sync

# View help
atris
```

### Publishing
```bash
# Update version in package.json
npm version patch|minor|major

# Publish to npm
npm publish
```

## Key Implementation Details

### Command: `atris init`
Located in `bin/atris.js:27-100`

**Behavior:**
1. Creates `atris/` directory in current working directory
2. Creates `atris/agent_team/` subdirectory
3. Copies source `atris.md` from package installation to `atris/atris.md`
4. Creates placeholder files for:
   - MAP.md
   - TASK_CONTEXTS.md
   - agent_team/navigator.md
   - agent_team/executor.md
   - agent_team/validator.md
5. All placeholders contain instructions to run AI agent with atris.md

**Key Path Resolution:**
- Source file: `__dirname/../atris.md` (from package installation)
- Target directory: `process.cwd()/atris/` (user's current directory)

### Command: `atris sync`
Located in `bin/atris.js:102-132`

**Behavior:**
1. Checks if `atris/` folder exists (error if not)
2. Compares content of installed `atris.md` with `atris/atris.md`
3. Updates local copy if different
4. Prompts user to regenerate MAP.md and agents with latest spec

### The ATRIS Spec (atris.md)
Located in root: `atris.md:1-276`

**5-Phase System:**
1. **Phase 1**: Generate MAP.md - Universal navigation with file:line references
2. **Phase 2**: Spawn 3 agent specs (navigator, executor, validator)
3. **Phase 3**: Auto-generate TASK_CONTEXTS.md from MAP insights
4. **Phase 4**: Activation - agents reference artifacts automatically
5. **Phase 5**: Future roadmap (sync, sessions, crew orchestration)

**Critical for AI Agents:**
- When an AI agent encounters `atris.md`, it should execute Phases 1-4
- Navigator agent answers "where is X?" with MAP.md references
- Executor agent extracts context before making changes
- Validator agent runs checks and updates MAP.md after changes

## Package Configuration

- **Name**: `atris`
- **Version**: `1.2.0` (currently in package.json)
- **License**: MIT
- **Binary**: `atris` → `./bin/atris.js`
- **Repository**: https://github.com/atrislabs/atris.md.git
- **No runtime dependencies** - uses only Node.js built-in modules

## Important Files & Line References

- `bin/atris.js:1-133` - Complete CLI implementation
  - `bin/atris.js:17-25` - Command routing logic
  - `bin/atris.js:27-100` - init command implementation
  - `bin/atris.js:102-132` - sync command implementation
- `atris.md:1-276` - Complete ATRIS specification
  - `atris.md:11-44` - Phase 1 (MAP.md generation)
  - `atris.md:46-127` - Phase 2 (3 agent specs)
  - `atris.md:129-181` - Phase 3 (TASK_CONTEXTS.md)
  - `atris.md:183-211` - Phase 4 (Activation & handoff)
- `package.json:1-19` - Package metadata and configuration
- `README.md:1-4` - Brief project description

## Making Changes

### When Modifying bin/atris.js
- Keep it dependency-free (no npm packages beyond Node.js built-ins)
- Preserve the CLI UX: simple commands, clear output with ✓/✗ symbols
- Maintain the folder structure contract (atris/agent_team/)
- Test both `init` and `sync` commands after changes

### When Updating atris.md Spec
- Update version in header (currently v1.3.0)
- Increment package.json version
- Run `atris sync` in test projects to verify sync functionality
- Ensure backward compatibility with existing generated artifacts

### When Adding New Commands
- Add to command routing in `bin/atris.js:16-24`
- Create new function following `initAtris()` and `syncAtris()` patterns
- Update help output in `bin/atris.js:8-13`
- Document in README.md if user-facing

## Design Principles

1. **Markdown as Interface** - All artifacts are markdown files for universal readability
2. **Exact References** - Always use file:line notation for precision
3. **Zero Dependencies** - CLI works with only Node.js standard library
4. **Folder Structure Contract** - `atris/` folder is the consistent pattern
5. **Agent-First Design** - Optimized for AI agent consumption and navigation

## For Gemini-Specific Features

- **Grounding**: Use the file:line references in MAP.md for precise grounding in codebase
- **Multimodal Context**: When analyzing code, reference both the code structure (MAP.md) and execution context (TASK_CONTEXTS.md)
- **Iterative Refinement**: Use the navigator → executor → validator flow for multi-step tasks
