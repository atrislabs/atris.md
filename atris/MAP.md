# MAP.md — atris_team Navigation Guide

> **Generated by Coding Agent** | Last updated: 2025-10-22 | System type: Node.js CLI tool

---

## Quick Reference Index

**Search Patterns (ripgrep shortcuts):**
```bash
# Core CLI logic
rg "function init" bin/atris.js           # Init command handler
rg "function sync" bin/atris.js           # Sync/update command handler
rg "function logAtris" bin/atris.js       # Daily logging system
rg "function visualizeAtris" bin/atris.js # Visualize command (approval gate)
rg "function showVersion" bin/atris.js    # Version command

# Documentation
rg "Quick Start" GETTING_STARTED.md       # User onboarding
rg "Phase 1" atris.md                     # Agent generation spec

# Package metadata
rg "version" package.json                 # Current version
rg "bin" package.json                     # CLI entry point
```

---

## By-Feature Map

### Feature: CLI Initialization (`atris init`)
**Purpose:** Creates atris/ folder structure with placeholders in user projects

- **Entry point:** `bin/atris.js:18-111` (initAtris function)
- **Creates:**
  - `atris/` folder
  - `atris/agent_team/` subfolder
  - `GETTING_STARTED.md`, `MAP.md`, `TASK_CONTEXTS.md` placeholders
  - `agent_team/navigator.md`, `executor.md`, `validator.md` placeholders
  - Copies `atris.md` from package

**Key logic:**
- Line 28-46: Folder creation
- Line 48-87: Placeholder file generation
- Line 89-106: Copy atris.md + success message

**Search:** `rg "function initAtris" bin/atris.js`

### Feature: Spec Sync (`atris update` / `atris sync`)
**Purpose:** Updates local atris.md to latest package version

- **Entry point:** `bin/atris.js:20-21, 113-143` (syncAtris function)
- **Logic:**
  - Line 114-122: Validate atris/ folder exists
  - Line 125-128: Check source file exists
  - Line 131-137: Compare content, skip if identical
  - Line 140-142: Copy new version + notify user

**Search:** `rg "function syncAtris" bin/atris.js`

### Feature: Daily Logging (`atris log`)
**Purpose:** Interactive logging session for daily notes

- **Entry point:** `bin/atris.js:200-252` (logAtris function)
- **Creates:** `atris/logs/YYYY/YYYY-MM-DD.md` files
- **Logic:**
  - Line 210-216: Ensure log directory and file exist
  - Line 218-252: Interactive readline session
  - Each entry appends as bullet point to today's log
  - Type "exit" to quit

**Search:** `rg "function logAtris" bin/atris.js`

### Feature: Bidirectional Journal Sync (`atris log sync`)
**Purpose:** Sync journal between local CLI and web app with timestamp conflict resolution

- **Entry point:** `bin/atris.js:308-414` (logSyncAtris function)
- **Pareto approach:** Timestamp comparison + user choice (no complex merge logic)
- **Logic:**
  - Line 367-370: GET request to fetch remote journal entry
  - Line 376-406: Bidirectional sync logic
    - Compare remote vs local timestamps
    - If remote newer: prompt "Overwrite local? (y/n)"
    - If user says yes: pull remote content to local
    - If user says no: continue with push
    - If timestamps equal: "Already synced"
  - Line 413-420: Push local content to remote (if not pulled)
- **Value:** Prevents web edits from being overwritten without adding complexity

**Search:** `rg "Bidirectional sync" bin/atris.js`

### Feature: Visualize Ideas (`atris visualize`)
**Purpose:** Break down inbox ideas with 3-4 sentences + ASCII diagram - universal approval gate for agents

- **Entry point:** `bin/atris.js:1289-1353` (visualizeAtris function)
- **Input:** Reads `## Inbox` section from today's journal
- **Process:**
  - Line 1302: Extracts Inbox section from log file
  - Line 1308-1315: Parses items in `- **I#: Description**` format
  - Line 1329-1348: Displays agent prompt template + ASCII example
- **Output:** Shows idea breakdown with 3-4 sentence steps + ASCII visualization
- **Purpose:** Confirms understanding before task creation (navigator/executor/validator approval gate)

**Search:** `rg "function visualizeAtris" bin/atris.js`

### Feature: Agent Activation Commands
**Purpose:** Direct command activation of navigator/executor/validator agent modes

**Commands:**
1. **`atris plan`** - Navigator mode
   - Entry: `bin/atris.js:1396-1456` (planAtris function)
   - Outputs: navigator.md spec + Inbox context + TASK_CONTEXTS.md
   - Purpose: Brainstorm and create tasks from journal Inbox

2. **`atris do`** - Executor mode
   - Entry: `bin/atris.js:1458-1509` (doAtris function)
   - Outputs: executor.md spec + TASK_CONTEXTS.md + MAP.md reference
   - Purpose: Build tasks with ASCII confirmation per step

3. **`atris review`** - Validator mode
   - Entry: `bin/atris.js:1511-1571` (reviewAtris function)
   - Outputs: validator.md spec + TASK_CONTEXTS.md + MAP.md + journal path
   - Purpose: Ultrathink validation, test, clean docs

**Flow:** `activate → log → plan → do → review → loop`

**Search:** `rg "function planAtris|function doAtris|function reviewAtris" bin/atris.js`

### Feature: System Status (`atris status`)
**Purpose:** Quick visibility into system state at a glance - supports parallel agent work

- **Entry point:** `bin/atris.js:1576-1710` (statusAtris function)
- **Reads:**
  - TASK_CONTEXTS.md Backlog for unclaimed tasks
  - TASK_CONTEXTS.md In Progress for claimed tasks (shows who claimed + when)
  - Today's journal Inbox for pending ideas (shows first 3)
  - Today's journal Completed section for recent completions (last 3)
- **Output:**
  - Backlog (unclaimed) count + list
  - In Progress (claimed) count + list with ownership
  - Inbox items count + preview
  - Recent completions (last 3)
  - Next suggested command
- **Value:** Parallel work visibility - see who's working on what without conflicts

**Search:** `rg "function statusAtris" bin/atris.js`

### Feature: Multi-Agent Task Coordination
**Purpose:** Enable parallel work without conflicts - multiple agents/humans can work simultaneously

- **File:** `atris/TASK_CONTEXTS.md`
- **Structure:**
  - **Backlog:** Unclaimed tasks created by navigator
  - **In Progress:** Tasks claimed by executor (includes "Claimed by: [Name] at [Time]")
  - **Target state:** 0 tasks (all sections empty when work complete)
- **Claiming mechanism:**
  1. Executor picks task from Backlog
  2. Moves to In Progress
  3. Adds claim: `**Claimed by:** [Agent/Name] at [Timestamp]`
  4. First to claim owns it - prevents conflicts
- **Flow:** Backlog (unclaimed) → In Progress (claimed) → Completed (deleted by validator)
- **Value:** Parallel execution without race conditions. Simple first-claim ownership model.

**Search:** `rg "## Backlog|## In Progress" atris/TASK_CONTEXTS.md`

### Feature: Validator Agent Spec
**Purpose:** The final gate - ultrathink validation before human review

- **Spec file:** `atris/agent_team/validator.md` (151 lines)
- **Skills:**
  - Line 11: Use the word "ultrathink" - think 3 times before deciding
  - Line 12-16: 3-4 sentence responses, ASCII visualize, auto-fix bugs, extract lessons
  - Line 73-76: Create validation checks if none exist
- **Flow:** Read task spec → ultrathink → validate → fix bugs → verify docs → extract lesson → human review guide
- **Purpose:** Ensure nothing ships broken. Strong validator = ship fast without fear.

**Search:** `rg "ultrathink" atris/agent_team/validator.md`

### Feature: Version Command (`atris version`)
**Purpose:** Show installed ATRIS version

- **Entry point:** `bin/atris.js:518-528` (showVersion function)
- **Reads:** `package.json` version field
- **Output:** `atris v1.3.0`

**Search:** `rg "function showVersion" bin/atris.js`

### Feature: Universal System Instrumentation Spec
**Purpose:** Defines how AI agents transform any system into an AI-navigable workspace

- **Spec file:** `atris.md` (11,559 bytes, ~280 lines)
- **Sections:**
  - Phase 1 (lines 11-43): MAP.md generation
  - Phase 2 (lines 47-125): Agent spawning (navigator, executor, validator)
  - Phase 3 (lines 129-195): TASK_CONTEXTS.md generation
  - Phase 4 (lines 184-211): Activation & validation
  - Phase 5 (lines 214-218): Future roadmap

**Search:** `rg "## Phase" atris.md`

### Feature: User Onboarding
**Purpose:** Human-friendly guide for new users

- **File:** `GETTING_STARTED.md` (3,987 bytes, ~140 lines)
- **Sections:**
  - Lines 1-20: What just happened (folder structure explanation)
  - Lines 22-42: Quick start (3 steps to populate files)
  - Lines 44-93: File explanations (MAP, agents, TASK_CONTEXTS)
  - Lines 95-118: Using agents (navigator, executor, validator)
  - Lines 120-127: Keeping updated

**Search:** `rg "## Quick Start" GETTING_STARTED.md`

---

## By-Concern Map

### Concern: Package Distribution
**Files:**
- `package.json` (19 lines) — npm metadata, version 1.3.0, bin config
- `bin/atris.js` (144 lines) — CLI entry point, executable

**Dependencies:** None (vanilla Node.js, uses only fs/path)

**Search:** `rg "\"bin\"" package.json`

### Concern: Documentation System
**Files:**
- ⭐ `atris.md` (280 lines) — Technical spec for AI agents
- ⭐ `GETTING_STARTED.md` (140 lines) — User guide
- `README.md` (3 lines) — Project overview

**Purpose:** atris.md = AI instructions, GETTING_STARTED.md = human instructions

**Search:** `rg "# Getting Started" GETTING_STARTED.md`

### Concern: File System Operations
**Location:** `bin/atris.js`

**Operations:**
- Folder creation: Lines 35-46 (atris/, agent_team/)
- File copying: Lines 59-62 (GETTING_STARTED.md), 91-92 (atris.md), 140 (sync)
- File writing: Lines 64-87 (placeholders)
- Existence checks: Lines 35, 43, 55-77, 119-122

**Pattern:** Always check existence before create/copy

**Search:** `rg "fs\\.existsSync|fs\\.mkdirSync|fs\\.copyFileSync|fs\\.writeFileSync" bin/atris.js`

---

## Critical Files (⭐ High-Impact)

### ⭐ `bin/atris.js` (144 lines, 4.2KB)
**Why critical:** Core CLI logic, all commands implemented here

**Functions:**
- `initAtris()` (lines 28-111): 84 lines, creates full folder structure
- `syncAtris()` (lines 113-143): 31 lines, updates atris.md

**Risk:** Breaking changes here affect all users

**Tests:** None currently (manual testing only)

**Search:** `rg "function" bin/atris.js`

### ⭐ `atris.md` (280 lines, 11.6KB)
**Why critical:** Source of truth for AI agent behavior

**Structure:**
- 5 phases (scaffold → agents → tasks → validate → future)
- 3 agent specs (navigator, executor, validator)
- Complexity/risk scoring system (lines 141-161)

**Version:** v1.3.0 (line 1)

**Impact:** Changes here propagate to all users on `atris update`

**Search:** `rg "## Phase" atris.md`

### ⭐ `package.json` (19 lines)
**Why critical:** Defines package name, version, bin entry

**Key fields:**
- `name`: "atris"
- `version`: "1.3.0"
- `bin.atris`: "./bin/atris.js"

**Impact:** Version bumps trigger npm publish

**Search:** `cat package.json`

### ⭐ `GETTING_STARTED.md` (140 lines, 4KB)
**Why critical:** First thing users read, sets expectations

**Flow:**
1. Explain what happened (folder structure)
2. Give 3-step quick start
3. Explain each file's purpose
4. Show how to use agents

**Impact:** Poor onboarding = user confusion

**Search:** `rg "## What Just Happened" GETTING_STARTED.md`

---

## Entry Points

### Entry Point 1: CLI Installation
```bash
npm install -g atris
atris --help
```
**Flow:** npm registry → global install → `bin/atris.js` becomes `atris` command

### Entry Point 2: Initialize Project
```bash
cd /path/to/project
atris init
```
**Flow:** `bin/atris.js:18` → `initAtris()` → creates `atris/` structure

### Entry Point 3: AI Agent Execution
```bash
# User opens atris/atris.md
# Pastes to Claude/Windsurf/Cursor with: "Execute Phase 1-4"
```
**Flow:** AI reads atris.md → generates MAP.md, agents/, TASK_CONTEXTS.md

### Entry Point 4: Update Spec
```bash
atris update
```
**Flow:** `bin/atris.js:20` → `syncAtris()` → copies latest atris.md from package

### Entry Point 5: Development/Publish
```bash
npm link              # Local testing
npm publish           # Push to npm registry
```
**Flow:** Development → test with `npm link` → bump version → publish

---

## Architecture Flows

### Flow 1: User Onboarding (Happy Path)
```
User: npm install -g atris
  ↓
User: atris init (in project folder)
  ↓
CLI: Creates atris/ folder + placeholders
  ↓
User: Reads atris/GETTING_STARTED.md
  ↓
User: Opens atris/atris.md, pastes to Claude
  ↓
Claude: Generates MAP.md, agent_team/*.md, TASK_CONTEXTS.md
  ↓
User: Now has fully instrumented system
```

### Flow 2: Spec Update
```
Maintainer: Updates atris.md (adds features)
  ↓
Maintainer: Bumps version in package.json
  ↓
Maintainer: npm publish
  ↓
User: atris update (in their project)
  ↓
CLI: Copies new atris.md to user's atris/
  ↓
User: Re-runs AI agent → regenerates files with new spec
```

### Flow 3: Package Development
```
Developer: Edits bin/atris.js or atris.md
  ↓
Developer: npm link (test locally)
  ↓
Developer: atris init (in test folder)
  ↓
Developer: Validates output
  ↓
Developer: Bumps version
  ↓
Developer: npm publish
  ↓
Users: npm install -g atris@latest (get update)
```

---

## Dependencies & Coupling

**External Dependencies:** NONE
- Uses only Node.js built-ins: `fs`, `path`
- No package.json dependencies field
- Zero npm packages required

**Internal Coupling:**
- `bin/atris.js` depends on `atris.md` existing at `__dirname/../atris.md`
- `bin/atris.js` depends on `GETTING_STARTED.md` existing at `__dirname/../GETTING_STARTED.md`
- Both files must be included in npm package for CLI to work

**Deployment Coupling:**
- `package.json` "bin" field must point to `bin/atris.js`
- `bin/atris.js` must have `#!/usr/bin/env node` shebang
- `bin/atris.js` must be executable (`chmod +x`)

**Risk zones:**
- If `atris.md` or `GETTING_STARTED.md` are missing from package, init fails
- If `bin` path changes in package.json, global `atris` command breaks

---

## TODOs & Potential Improvements

**Current:** No TODOs/FIXMEs in codebase

**Potential improvements:**
1. Add tests for CLI commands
2. Add version mismatch detection (warn if local atris.md is very old)
3. Add `atris validate` command to check if structure is complete
4. Add LLM integration so CLI auto-generates files (no manual paste)
5. Add templates system (`atris init --template product`)

---

## Project Stats

**Total files:** 17 (excluding node_modules, .git)
**Critical files:** 4 (bin/atris.js, atris.md, package.json, GETTING_STARTED.md)
**Lines of code:** ~565 (144 CLI + 280 spec + 140 onboarding)
**Dependencies:** 0 external
**Commands:** 3 (init, update/sync, help)
**Version:** 1.3.0

**Architecture:** Simple, single-file CLI with bundled markdown specs

---

## Quick Navigation Cheat Sheet

```bash
# Find command implementation
rg "function initAtris" bin/atris.js

# Find spec section
rg "## Phase 1" atris.md

# Check version
rg "version" package.json

# View user guide
cat GETTING_STARTED.md

# Test locally
npm link && atris init

# Publish
npm publish
```

---

**End of MAP.md** | Questions? Reference this file for "where is X?" queries.
