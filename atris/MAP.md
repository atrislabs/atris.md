# MAP.md — atris_team Navigation Guide

> **Generated by Coding Agent** | Last updated: 2025-11-11 | System type: Node.js CLI tool

---

## Quick Reference Index

**Search Patterns (ripgrep shortcuts):**
```bash
# Core CLI logic
rg "function atrisDevEntry" bin/atris.js    # Main entry point (atris command)
rg "function brainstormAtris" commands/brainstorm.js  # Brainstorm command (line 10)
rg "function planAtris" commands/workflow.js   # Plan command (line 5)
rg "function doAtris" commands/workflow.js     # Do command (line 297)
rg "function reviewAtris" commands/workflow.js  # Review command (line 667)
rg "function statusAtris" commands/status.js     # Status command (line 5)
rg "function analyticsAtris" commands/analytics.js  # Analytics command (line 4)

# Modular commands
rg "initAtris" commands/init.js             # Init command
rg "syncAtris" commands/sync.js             # Update/sync command
rg "logAtris" commands/log.js               # Log command
rg "logSyncAtris" commands/log-sync.js      # Log sync command
rg "loginAtris" commands/auth.js            # Auth commands

# Utilities
rg "ensureValidCredentials" utils/auth.js   # Auth flow
rg "apiRequestJson" utils/api.js            # API requests
rg "checkForUpdates" utils/update-check.js  # Version checks

# Documentation
rg "Phase 1" atris.md                       # Agent generation spec
```

---

## By-Feature Map

### Feature: Natural Language Interface (`atris [anything]`)
**Purpose:** Universal entry point - accepts any input and routes intelligently

- **Entry point:** `bin/atris.js:138-158` (main routing logic)
- **Handler:** `bin/atris.js:2246-3282` (atrisDevEntry function)
- **How it works:**
  - No args → Cold start (shows context, waits for input)
  - With args → Hot start (treats input as task description)
  - Loads context from state detection
  - Shows atrisDev protocol instructions
  - Tells agents to: visualize → approve → build → review
- **Examples:**
  - `atris` → Shows context + instructions
  - `atris fix the auth bug` → Hot start with task
  - `atris build user dashboard` → Hot start with feature
- **Value:** Single command for everything, natural language input

**Search:** `rg "atrisDevEntry" bin/atris.js`

### Feature: Project Initialization (`atris init`)
**Purpose:** Creates atris/ folder structure with placeholders + auto-detects project type

- **Entry point:** `commands/init.js:230-644` (initAtris function)
- **Project Detection:** `commands/init.js:9-154` (detectProjectContext)
- **Pattern Injection:** `commands/init.js:156-228` (injectProjectPatterns)
- **Creates:**
  - `atris/` folder
  - `atris/agent_team/` subfolder with agent specs
  - `atris/features/` subfolder with README template
  - `GETTING_STARTED.md`, `MAP.md`, `TASK_CONTEXTS.md` placeholders
  - `.project-profile.json` (project detection metadata)
  - Copies `atris.md` from package
- **Project Detection:**
  - Supports: Node.js, Python, Ruby/Rails, Go, Rust, Java, PHP, Elixir, knowledge bases
  - Auto-detects: Framework (React, Vue, Django, Rails, etc.), test commands, file structure
  - Injects: Project-native instructions into agent specs
- **v1.9.6 update:** Now auto-creates `atris/features/` directory with README template

**Search:** `rg "detectProjectContext|injectProjectPatterns" commands/init.js`

### Feature: Spec Update (`atris update`)
**Purpose:** Updates local atris.md to latest package version

- **Entry point:** `commands/sync.js:4-61` (syncAtris function)
- **Logic:**
  - Validates atris/ folder exists
  - Compares content with package atris.md
  - Copies new version if different
  - Prompts user to regenerate MAP.md and agents
- **Value:** Keep local spec in sync with npm package

**Search:** `rg "syncAtris" commands/sync.js`

### Feature: Daily Logging (`atris log`)
**Purpose:** Add ideas to inbox in today's journal

- **Entry point:** `commands/log.js:4-56` (logAtris function)
- **Creates:** `atris/logs/YYYY/YYYY-MM-DD.md` files
- **Logic:**
  - Uses `lib/journal.js` for file operations
  - Interactive readline session
  - Appends to `## Inbox` section
  - Type "exit" to quit
- **Value:** Quick brain dump without context switching

**Search:** `rg "logAtris" commands/log.js`

### Feature: Journal Sync (`atris log sync`)
**Purpose:** Bidirectional sync between local journal and cloud

- **Entry point:** `commands/log-sync.js:11-356` (logSyncAtris function)
- **Strategy:** Timestamp comparison + user choice (no complex merge)
- **Logic:**
  - Fetches remote journal entry
  - Compares timestamps
  - If remote newer: prompts to pull
  - If local newer: pushes to cloud
  - Handles conflicts with user prompts
- **Dependencies:** Requires valid credentials
- **Value:** Sync journal between CLI and web app

**Search:** `rg "logSyncAtris" commands/log-sync.js`

### Feature: Brainstorm Mode (`atris brainstorm`) — v2.0.0
**Purpose:** Conversational exploration before planning - supportive, one question at a time

- **Entry point:** `bin/atris.js:574` (command routing)
- **Handler:** `commands/brainstorm.js:10-344` (brainstormAtris function)
- **Autopilot:** `commands/brainstorm.js:466-1081` (autopilotAtris function)
- **How it works:**
  - Interactive session with supportive questioning
  - 3-4 sentences max per response
  - ONE question at a time (never multiple)
  - No files created (exploration only)
  - User says "ready" or "plan" to exit
- **Workflow:** Optional step 0 before `atris plan`
  - brainstorm (optional) → plan → do → review
- **Value:** Helps users clarify uncertain ideas before committing to implementation
- **Documentation:**
  - `atris/PERSONA.md:31-67` (brainstorm mode communication style)
  - `atris.md:499-521` (Phase 5.2 workflow with step 0)
  - `atris/features/brainstorm/` (feature specs)

**Search:** `rg "brainstormAtris" bin/atris.js`

### Feature: System Status (`atris status`)
**Purpose:** Quick visibility into system state - supports parallel work

- **Entry point:** `commands/status.js:5-156` (statusAtris function)
- **Reads:**
  - TASK_CONTEXTS.md Backlog (unclaimed tasks)
  - TASK_CONTEXTS.md In Progress (claimed tasks with ownership)
  - Today's journal Inbox (pending ideas, first 3)
  - Today's journal Completed (recent completions, last 3)
- **Output:**
  - Backlog count + list
  - In Progress count + list with claims
  - Inbox preview
  - Recent completions
  - Next suggested command
- **Value:** Parallel work visibility - see who's working on what

**Search:** `rg "statusAtris" bin/atris.js`

### Feature: Workspace Cleanup (`atris clean`)
**Purpose:** Housekeeping - find stale tasks, archive old journals, detect broken refs

- **Entry point:** `commands/clean.js:11-97` (cleanAtris function)
- **Helpers:**
  - `findStaleTasks()` (lines 103-147): Find tasks claimed >3 days ago
  - `findBrokenMapRefs()` (lines 153-199): Validate MAP.md file:line refs
  - `archiveOldJournals()` (lines 205-247): Move journals >30 days to archive/
  - `cleanEmptySections()` (lines 253-282): Remove placeholder sections
- **Output:**
  - Stale task warnings
  - Broken MAP.md ref list
  - Archive count
  - Cleaned section count
- **Flags:** `--dry-run` / `-n` to preview without changes
- **Value:** Keep workspace clean, trust in MAP.md

**Search:** `rg "cleanAtris" commands/clean.js`

### Feature: Work Verification (`atris verify`)
**Purpose:** Validate work is actually done - tests pass, MAP.md updated, changes exist

- **Entry point:** `commands/verify.js:14-47` (verifyAtris function)
- **Modes:**
  - `atris verify` — Verify entire workspace health
  - `atris verify [task]` — Verify specific task completion
- **Checks:**
  - MAP.md has real content (not placeholder)
  - Tests pass (auto-detects npm test, pytest, etc.)
  - Recent git changes are documented in MAP.md
  - Task-specific: claimed files exist, symbols defined
- **Output:**
  - Verification status per check
  - VERIFIED ✓ or issue count
- **Value:** Confidence before marking work complete

**Search:** `rg "verifyAtris" commands/verify.js`

### Feature: Analytics (`atris analytics`)
**Purpose:** Productivity insights from existing journal data

- **Entry point:** `commands/analytics.js:4-147` (analyticsAtris function)
- **Pareto insight:** No new instrumentation - parses existing markdown
- **Data sources:**
  - Completions: `- **C#: description**` pattern
  - Inbox items: `- **I#: description**` pattern
  - Analyzes last 7 days from `logs/YYYY/YYYY-MM-DD.md`
- **Metrics:**
  - Today's completions and inbox count
  - Weekly total completions and velocity (avg/day)
  - Inbox trend (Growing/Shrinking/Stable)
  - Daily breakdown with visual bar chart
- **Output:** Terminal display with charts
- **Value:** Motivating insights without complexity

**Search:** `rg "analyticsAtris" bin/atris.js`

### Feature: Visualize Ideas (`atris visualize`)
**Purpose:** Break down inbox ideas with ASCII diagram - approval gate for agents

- **Entry point:** `commands/visualize.js:5-72` (visualizeAtris function)
- **Input:** Reads `## Inbox` from today's journal
- **Process:**
  - Extracts inbox items (format: `- **I#: Description**`)
  - Shows agent prompt with ASCII example
  - Waits for human approval
- **Purpose:** Confirms understanding before building
- **Value:** Prevents wasted work on misunderstood tasks

**Search:** `rg "visualizeAtris" commands/visualize.js`

### Feature: Autopilot (`atris autopilot`)
**Purpose:** Guided loop - plan → do → review with success criteria

- **Entry point:** `commands/brainstorm.js:466-1081` (autopilotAtris function)
- **Flow:**
  - Vision phase: Define problem, success criteria, risks
  - Iteration loop: Plan → execute → validate
  - Success gate: All criteria met → complete
- **Workflow files:** `atris/.autopilot/[timestamp]-workflow.json`
- **Journal logging:** Records vision + iterations in Notes section
- **Value:** Structured guidance for complex multi-step work

**Search:** `rg "autopilotAtris" commands/brainstorm.js`

### Feature: Agent Activation Commands
**Purpose:** Direct activation of navigator/executor/validator modes

**Commands:**
1. **`atris plan`** - Navigator mode
   - Entry: `commands/workflow.js:5-295` (planAtris function)
   - Outputs: navigator.md spec + Inbox context + TODO.md
   - Purpose: Brainstorm and create tasks from inbox

2. **`atris do`** - Executor mode
   - Entry: `commands/workflow.js:297-665` (doAtris function)
   - Outputs: executor.md spec + TODO.md + MAP.md
   - Purpose: Build tasks with step-by-step confirmation

3. **`atris review`** - Validator mode
   - Entry: `commands/workflow.js:667-1005` (reviewAtris function)
   - Outputs: validator.md spec + TODO.md + MAP.md + journal
   - Purpose: Ultrathink validation, test, clean docs

4. **`atris launch`** - Launcher mode (DEPRECATED)
   - Entry: `bin/atris.js:2376-4105` (launchAtris function)
   - Purpose: Cross-team integration and deployment

**Flow:** `atris → plan → do → review → loop`

**Search:** `rg "planAtris|doAtris|reviewAtris" bin/atris.js`

### Feature: Authentication (`atris login/logout/whoami`)
**Purpose:** Optional cloud features - auth with Atris backend

- **Entry point:** `commands/auth.js:4-134`
  - `loginAtris` (lines 4-103): Google OAuth flow
  - `logoutAtris` (lines 105-116): Delete credentials
  - `whoamiAtris` (lines 118-132): Show auth status
- **Credentials storage:** `~/.atris/credentials.json`
- **Flow:**
  - Opens browser for Google OAuth
  - Saves token, refresh token, email, userId
  - Auto-refreshes tokens before expiry
- **Dependencies:** `utils/auth.js` for token management
- **Value:** Enables cloud sync, chat, agent selection

**Search:** `rg "loginAtris|logoutAtris|whoamiAtris" commands/auth.js`

### Feature: Version Check (`atris version`)
**Purpose:** Show installed ATRIS version

- **Entry point:** `commands/version.js:4-16` (showVersion function)
- **Reads:** `package.json` version field
- **Output:** `atris v2.0.20`

**Search:** `rg "showVersion" commands/version.js`

### Feature: Auto Update Check
**Purpose:** Notify users of new versions (non-blocking)

- **Entry point:** `utils/update-check.js:4-182`
- **Logic:**
  - Background check on every command (except version/update/help)
  - Fetches latest from npm registry
  - Compares with local version
  - Shows notification after command completes
- **Cache:** 24-hour cache to avoid spam
- **Value:** Keep users up-to-date without interrupting workflow

**Search:** `rg "checkForUpdates" utils/update-check.js`

### Feature: Agent Selection (`atris agent`)
**Purpose:** Select which cloud agent persona to use

- **Entry point:** `bin/atris.js:2065-2146` (agentAtris function)
- **Requires:** Valid credentials
- **Logic:**
  - Fetches available agents from backend
  - Interactive selection
  - Saves to `~/.atris/config.json`
- **Value:** Switch between different agent personalities

**Search:** `rg "agentAtris" bin/atris.js`

### Feature: Interactive Chat (`atris chat`)
**Purpose:** Real-time conversation with selected agent

- **Entry point:** `bin/atris.js:2149-2182` (chatAtris function)
- **Requires:** Valid credentials + selected agent
- **Modes:**
  - One-shot: `atris chat "message"`
  - Interactive: `atris chat` (REPL)
- **Uses:** `utils/claude_sdk.js` for API communication
- **Value:** Quick questions without context switching

**Search:** `rg "chatAtris" bin/atris.js`

### Feature: State Detection
**Purpose:** Smart context loading based on workspace state

- **Entry point:** `lib/state-detection.js:4-138`
- **Functions:**
  - `detectWorkspaceState()` (lines 4-80): Detect state (uninit/active/stale)
  - `loadContext()` (lines 82-138): Load relevant context
- **States:**
  - Uninitialized: No atris/ folder
  - Active: Recent journal entries
  - Stale: No activity in 7+ days
- **Value:** Adaptive context loading

**Search:** `rg "detectWorkspaceState|loadContext" lib/state-detection.js`

---

## By-Concern Map

### Concern: Package Distribution
**Files:**
- `package.json` (37 lines) — npm metadata, version 2.0.20, bin config
- `bin/atris.js` (2,628 lines) — CLI entry point, executable

**Dependencies:** None (vanilla Node.js)

**Search:** `rg "\"bin\"" package.json`

### Concern: Command Routing
**File:** `bin/atris.js`

**Logic:**
- Lines 93-131: Help text
- Lines 134-135: Known commands list
- Lines 138-158: Natural language routing (cold/hot start)
- Lines 161-237: Command dispatch

**Pattern:** Modular commands (commands/*.js) + monolithic bin/atris.js

**Search:** `rg "else if \(command ===" bin/atris.js`

### Concern: File System Operations
**Files:**
- `lib/file-ops.js` (289 lines) — File/folder utilities
- `lib/journal.js` (172 lines) — Journal-specific operations

**Operations:**
- Folder creation with safety checks
- File copying with existence checks
- Atomic writes
- Section-based markdown editing

**Pattern:** Always check existence before create/copy

**Search:** `rg "ensureLogDirectory|createLogFile" lib/journal.js`

### Concern: API Communication
**Files:**
- `utils/api.js` (299 lines) — HTTP requests, error handling
- `utils/claude_sdk.js` (172 lines) — Claude API wrapper

**Key functions:**
- `apiRequestJson()` — Generic API requests
- `httpRequest()` — Low-level HTTP
- `streamChatResponse()` — Streaming chat

**Pattern:** JSON-based REST API with token auth

**Search:** `rg "apiRequestJson|httpRequest" utils/api.js`

### Concern: Authentication & Token Management
**File:** `utils/auth.js` (382 lines)

**Key functions:**
- Lines 4-66: Credential storage (save/load/delete)
- Lines 68-123: Token validation and refresh
- Lines 125-256: `ensureValidCredentials()` — Auto-refresh flow
- Lines 258-301: Account summary display

**Pattern:** JWT with auto-refresh, 5-min buffer before expiry

**Search:** `rg "ensureValidCredentials|refreshAccessToken" utils/auth.js`

### Concern: Configuration Management
**File:** `utils/config.js` (66 lines)

**Stores:**
- Selected agent ID
- API base URL
- Custom preferences

**Location:** `~/.atris/config.json`

**Search:** `rg "loadConfig|saveConfig" utils/config.js`

### Concern: Documentation System
**Files:**
- ⭐ `atris.md` (470 lines) — Technical spec for AI agents
- ⭐ `GETTING_STARTED.md` (140 lines) — User guide
- ⭐ `PERSONA.md` (155 lines) — Communication style & anti-slop patterns
- ⭐ `atris/features/README.md` — Feature documentation guide
- ⭐ `atris/features/_templates/` — idea.md & build.md templates
- `README.md` (17 lines) — Project overview
- `docs/README.md` — Legacy docs (deprecated, points to atris/features/)

**Purpose:**
- atris.md = AI instructions
- GETTING_STARTED.md = human instructions
- PERSONA.md = workflow enforcement, anti-slop examples (v1.9.7)
- Features templates = standardized structure for new features (v1.9.7)

**Recent updates (v1.9.7):**
- All `docs/features/` paths migrated to `atris/features/`
- PERSONA.md expanded with workflow anti-patterns (no explainer loops, no skip-visualization)
- CLI enforces approval gates: visualization → approval → docs → code
- Feature templates created for consistent structure

**Search:** `rg "## Phase" atris.md | rg "anti-pattern|⚠️  APPROVAL" atris/PERSONA.md bin/atris.js`

### Concern: Skills
**Files:**
- `atris/skills/atris/SKILL.md` — Atris workflow skill
- `atris/skills/writing/SKILL.md` — Writing skill
- `atris/skills/README.md` — Skills pattern + Claude symlink instructions

**Use:** Codex skills for Atris workflow and writing guidance; Claude integration uses `.claude/skills` symlinks (see `atris/skills/README.md`).

**Search:** `rg --files -g "SKILL.md" atris/skills`

### Concern: Output Quality Policies
**Files:**
- `policies/ANTISLOP.md` — Anti-slop checklist (language kill list, complexity matching)
- `atris/policies/ANTISLOP.md` — Template copy for user projects
- `atris/policies/LESSONS.md` — Short lessons after REVIEW misses
- `atris/policies/atris-design.md` — Frontend aesthetics policy
- `atris/policies/atris-backend.md` — Backend architecture policy
- `atris/policies/writing.md` — Essay writing skill

**Purpose:** Enforce quality standards and prevent generic AI output.

**Search:** `rg "slop|kill list" policies/`

---

### Concern: Skill Creation (external tools)
**Scripts:**
- `/Users/keshavrao/.codex/skills/.system/skill-creator/scripts/init_skill.py`
- `/Users/keshavrao/.codex/skills/.system/skill-creator/scripts/package_skill.py`

**Use:** Initialize and package Codex skills.

---

## Critical Files (⭐ High-Impact)

### ⭐ `bin/atris.js` (2,628 lines, 93KB)
**Why critical:** Core CLI routing + entry point

**Key functions (in bin/atris.js):**
- Command routing (lines 234-700)
- `atrisDevEntry()` — Natural language entry

**Modular commands (in commands/):**
- `planAtris()` → `commands/workflow.js:5-295`
- `doAtris()` → `commands/workflow.js:297-665`
- `reviewAtris()` → `commands/workflow.js:667-1005`
- `statusAtris()` → `commands/status.js:5-156`
- `analyticsAtris()` → `commands/analytics.js:4-147`
- `brainstormAtris()` → `commands/brainstorm.js:10-344`

**Risk:** Breaking changes affect all users

**Tests:** None (manual testing only)

**Search:** `rg "^(function|async function)" bin/atris.js`

### ⭐ `atris.md` (470 lines, 23.3KB)
**Why critical:** Source of truth for AI agent behavior

**Structure:**
- Phase 1 (lines 11-43): MAP.md generation
- Phase 2 (lines 47-125): Agent specs (navigator, executor, validator)
- Phase 3 (lines 129-195): TASK_CONTEXTS.md generation
- Phase 4 (lines 184-211): Activation & validation
- Phase 5 (lines 260-467): Daily workflow + journal protocol
- Phase 5.2 (lines 469+): atrisDev protocol (visualize → approve → build)

**Version:** v2.0.20

**Impact:** Changes propagate to all users on `atris update`

**Search:** `rg "## Phase" atris.md`

### ⭐ `package.json` (37 lines)
**Why critical:** Defines package metadata, version, bin entry

**Key fields:**
- `name`: "atris"
- `version`: "2.0.20"
- `bin.atris`: "./bin/atris.js"
- `files`: Whitelist for npm publish

**Impact:** Version bumps trigger npm publish

**Search:** `cat package.json`

### ⭐ `commands/init.js` (644 lines)
**Why critical:** First-run experience, project detection

**Key functions:**
- `detectProjectContext()` (lines 9-154): Auto-detect project type
- `injectProjectPatterns()` (lines 156-228): Inject project-native instructions
- `initAtris()` (lines 230-644): Create folder structure

**Impact:** Onboarding UX, sets user expectations

**Search:** `rg "detectProjectContext|initAtris" commands/init.js`

### ⭐ `utils/auth.js` (382 lines, 10.2KB)
**Why critical:** Handles all authentication, token management

**Key functions:**
- `ensureValidCredentials()` (lines 125-256): Auto-refresh flow
- `refreshAccessToken()` (lines 68-99): Token refresh logic
- `validateAccessToken()` (lines 35-66): Token validation

**Impact:** Cloud features depend on this working correctly

**Search:** `rg "ensureValidCredentials" utils/auth.js`

---

## Entry Points

### Entry Point 1: CLI Installation
```bash
npm install -g atris
atris --help
```
**Flow:** npm registry → global install → `bin/atris.js` becomes `atris` command

### Entry Point 2: Initialize Project
```bash
cd /path/to/project
atris init
```
**Flow:** `bin/atris.js:174` → `commands/init.js:initAtris()` → creates `atris/` structure

### Entry Point 3: Natural Language Entry
```bash
atris
atris fix the auth bug
atris build user dashboard
```
**Flow:** `bin/atris.js:138` → `atrisDevEntry()` → loads context → shows protocol

### Entry Point 4: AI Agent Execution
```bash
# Agent reads atris/CLAUDE.md in editor
# Runs: atris
# Follows protocol: visualize → approve → build
```
**Flow:** Editor reads `atris/CLAUDE.md` → agent runs `atris` → follows protocol

### Entry Point 5: Update Spec
```bash
atris update
```
**Flow:** `bin/atris.js:190` → `commands/sync.js:syncAtris()` → copies latest atris.md

### Entry Point 6: Development/Publish
```bash
npm link              # Local testing
npm publish           # Push to npm
```
**Flow:** Development → test with `npm link` → bump version → publish

---

## Architecture Flows

### Flow 1: User Onboarding (Happy Path)
```
User: npm install -g atris
  ↓
User: atris init (in project folder)
  ↓
CLI: Creates atris/ folder + agent specs + features/ dir
  ↓
User: Reads atris/GETTING_STARTED.md
  ↓
User: Opens editor, agent reads atris/CLAUDE.md
  ↓
Agent: Runs atris command, follows protocol
  ↓
User: Has fully instrumented system
```

### Flow 2: atrisDev Protocol (v1.9+)
```
User: atris (or atris [task description])
  ↓
CLI: Loads context (MAP.md, journal, tasks)
  ↓
CLI: Shows atrisDev protocol instructions
  ↓
Agent: Creates visualization (ASCII diagram)
  ↓
Agent: Waits for approval (MUST NOT proceed)
  ↓
User: Approves visualization
  ↓
Agent: Creates atris/features/[name]/idea.md
  ↓
Agent: Creates atris/features/[name]/build.md
  ↓
Agent: Executes step-by-step, validates alignment
  ↓
Agent: Reviews, updates atris/features/README.md
  ↓
Agent: Adds completion to journal
```

### Flow 3: Authentication & Token Refresh
```
User: atris login
  ↓
CLI: Opens browser for Google OAuth
  ↓
User: Authorizes in browser
  ↓
CLI: Saves credentials to ~/.atris/credentials.json
  ↓
[Later, token expires]
  ↓
CLI: Auto-refreshes token (5-min buffer)
  ↓
CLI: Updates credentials.json with new token
  ↓
User: Continues working (transparent refresh)
```

### Flow 4: Journal Sync (Bidirectional)
```
User: atris log sync
  ↓
CLI: Fetches remote journal entry
  ↓
CLI: Compares timestamps (local vs remote)
  ↓
If remote newer:
  CLI: Prompts "Overwrite local? (y/n)"
  User: yes → Pull remote content
  User: no → Keep local, push to remote
  ↓
If local newer:
  CLI: Pushes local content to remote
  ↓
CLI: Updates sync state in ~/.atris/.log_sync_state.json
```

---

## Dependencies & Coupling

**External Dependencies:** NONE
- Uses only Node.js built-ins: `fs`, `path`, `child_process`, `readline`, `os`, `https`, `http`, `crypto`
- No package.json dependencies field
- Zero npm packages required

**Internal Coupling:**
- `bin/atris.js` depends on `commands/*.js` modules
- Commands depend on `utils/*.js` (auth, api, config)
- Commands depend on `lib/*.js` (file-ops, journal, state-detection)
- All files depend on `atris.md` existing at `__dirname/../atris.md`

**Deployment Coupling:**
- `package.json` "bin" field must point to `bin/atris.js`
- `package.json` "files" field must include all necessary directories
- `bin/atris.js` must have `#!/usr/bin/env node` shebang
- `bin/atris.js` must be executable (`chmod +x`)

**Risk zones:**
- If `atris.md` or agent specs missing from package, init fails
- If `bin` path changes in package.json, global command breaks
- If credentials format changes, auth breaks

---

## Project Stats

**Total files:** 24 JS files + docs
**Critical files:** 5 (bin/atris.js, atris.md, package.json, commands/init.js, utils/auth.js)
**Lines of code:** 9,875 (2,628 in bin/atris.js)
**Dependencies:** 0 external
**Commands:** 14 (init, update, log, status, analytics, plan, do, review, login, logout, whoami, agent, chat, version)
**Version:** 2.0.20

**Architecture:** Modular commands + monolithic core + zero dependencies

---

## Quick Navigation Cheat Sheet

```bash
# Find command implementation
rg "atrisDevEntry" bin/atris.js
rg "initAtris" commands/init.js
rg "logSyncAtris" commands/log-sync.js

# Find spec section
rg "## Phase 5.2" atris.md

# Check version
rg "version" package.json

# View user guide
cat GETTING_STARTED.md

# Test locally
npm link && cd ~/test-project && atris init

# Publish
npm publish
```

---

**End of MAP.md** | Questions? Reference this file for "where is X?" queries.
