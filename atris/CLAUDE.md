# AGENT.md

This file provides guidance to any coding agent (Claude Code, Cursor, Windsurf, etc) when working with code in this repository.

## ðŸŽ¯ atrisDev Protocol Active

**You are in an ATRIS-managed project.** Follow the atrisDev workflow for all feature development.

### Getting Started

**FIRST:** When user asks to build/plan/fix something, run this command:
```bash
atris
```

The output will tell you exactly what to do. Follow those instructions.

### atrisDev Workflow (Do this automatically)

When the user describes what they want to build, follow these steps:

**1. Show atris Visualization**
- Create a visual diagram showing architecture/flow
- Include: components, data flow, user experience
- Make it clear and easy to understand

**2. Wait for Approval**
- **MUST NOT** proceed until human confirms the plan

**3. Create idea.md**
- Path: `atris/features/[feature-name]/idea.md`
- Include: Problem statement, solution design, ASCII diagrams, success criteria

**4. Create build.md**
- Path: `atris/features/[feature-name]/build.md`
- Include: Step-by-step plan, files to change, testing strategy

**5. Execute Step by Step**
- Build one step at a time
- Validate alignment after each step

**6. Review & Validate**
- Run tests
- Update `atris/features/README.md`
- Add completion to journal

**Full protocol details:** See `atris.md` Phase 5.2

---

## Quick Reference

**Key files:**
- `atris/PERSONA.md` - Communication style (READ THIS FIRST)
- `atris/MAP.md` - Navigation guide (where is X?)
- `atris/TASK_CONTEXTS.md` - Active tasks (delete when done)
- `atris.md` - Full atrisDev protocol (Phase 5.2)
- `atris/agent_team/*.md` - Agent specs

## Project Overview

**ATRIS** is a universal system instrumentation tool for AI agents. It's a Node.js CLI package that transforms any codebase into a self-documenting, AI-navigable workspace by scaffolding a structured folder system with navigation guides and agent specifications.

**Core Concept**: Drop `atris.md` into any project â†’ Run `atris init` â†’ AI agents read the spec â†’ System becomes fully instrumented with MAP.md, agent specs, and task contexts in under 10 minutes.

## Architecture

### Entry Point
- `bin/atris.js` - CLI entry point (executable Node.js script)
  - Handles two commands: `init` and `sync`
  - No external dependencies beyond Node.js core modules (fs, path)

### File Structure Generated by ATRIS
When `atris init` runs, it creates:
```
atris/
â”œâ”€â”€ atris.md              (blueprint spec - copied from package)
â”œâ”€â”€ MAP.md                (navigation guide - populated by AI agents)
â”œâ”€â”€ TASK_CONTEXTS.md      (task bank - populated by AI agents)
â””â”€â”€ agent_team/
    â”œâ”€â”€ navigator.md      (system navigator spec)
    â”œâ”€â”€ executor.md       (task executor spec)
    â””â”€â”€ validator.md      (quality gatekeeper spec)
```

### Core Philosophy (from atris.md spec)
1. **MAP.md = Single Source of Truth** - All agents reference one navigation guide with file:line precision
2. **Exact Context** - Every reference includes file:line ranges (e.g., `auth.ts:15-45`)
3. **Self-Validating** - Validator agent keeps artifacts fresh automatically
4. **Universal Application** - Works for code, product, sales, research - any system
5. **Zero Ramp-up** - New agents read MAP.md and are immediately productive

## Development Commands

### Installation & Setup
```bash
# Install dependencies (currently none beyond Node.js built-ins)
npm install

# Link locally for testing
npm link

# Test CLI globally after linking
atris
atris init
atris update
```

### Testing the CLI
```bash
# Test init command (creates atris/ folder structure)
cd /path/to/test/project
atris init

# Test update command (updates atris.md to latest version)
atris update

# View help
atris
```

### Publishing
```bash
# Update version in package.json
npm version patch|minor|major

# Publish to npm
npm publish
```

## Key Implementation Details

### Command: `atris init`
Located in `bin/atris.js:27-100`

**Behavior:**
1. Creates `atris/` directory in current working directory
2. Creates `atris/agent_team/` subdirectory
3. Copies source `atris.md` from package installation to `atris/atris.md`
4. Creates placeholder files for:
   - MAP.md
   - TASK_CONTEXTS.md
   - agent_team/navigator.md
   - agent_team/executor.md
   - agent_team/validator.md
5. All placeholders contain instructions to run AI agent with atris.md

**Key Path Resolution:**
- Source file: `__dirname/../atris.md` (from package installation)
- Target directory: `process.cwd()/atris/` (user's current directory)

### Command: `atris update`
Located in `bin/atris.js:102-132`

**Behavior:**
1. Checks if `atris/` folder exists (error if not)
2. Compares content of installed `atris.md` with `atris/atris.md`
3. Updates local copy if different
4. Prompts user to regenerate MAP.md and agents with latest spec

### The ATRIS Spec (atris.md)
Located in root: `atris.md:1-276`

**5-Phase System:**
1. **Phase 1**: Generate MAP.md - Universal navigation with file:line references
2. **Phase 2**: Spawn 3 agent specs (navigator, executor, validator)
3. **Phase 3**: Auto-generate TASK_CONTEXTS.md from MAP insights
4. **Phase 4**: Activation - agents reference artifacts automatically
5. **Phase 5**: Future roadmap (sync, sessions, crew orchestration)

**Critical for AI Agents:**
- When an AI agent encounters `atris.md`, it should execute Phases 1-4
- Navigator agent answers "where is X?" with MAP.md references
- Executor agent extracts context before making changes
- Validator agent runs checks and updates MAP.md after changes

## Package Configuration

- **Name**: `atris`
- **Version**: `1.2.0` (currently in package.json)
- **License**: MIT
- **Binary**: `atris` â†’ `./bin/atris.js`
- **Repository**: https://github.com/atrislabs/atris.md.git
- **No runtime dependencies** - uses only Node.js built-in modules

## Important Files & Line References

- `bin/atris.js:1-133` - Complete CLI implementation
  - `bin/atris.js:17-25` - Command routing logic
  - `bin/atris.js:27-100` - init command implementation
  - `bin/atris.js:102-132` - update command implementation
- `atris.md:1-276` - Complete ATRIS specification
  - `atris.md:11-44` - Phase 1 (MAP.md generation)
  - `atris.md:46-127` - Phase 2 (3 agent specs)
  - `atris.md:129-181` - Phase 3 (TASK_CONTEXTS.md)
  - `atris.md:183-211` - Phase 4 (Activation & handoff)
- `package.json:1-19` - Package metadata and configuration
- `README.md:1-4` - Brief project description

## Making Changes

### When Modifying bin/atris.js
- Keep it dependency-free (no npm packages beyond Node.js built-ins)
- Preserve the CLI UX: simple commands, clear output with âœ“/âœ— symbols
- Maintain the folder structure contract (atris/agent_team/)
- Test both `init` and `update` commands after changes

### When Updating atris.md Spec
- Update version in header (currently v1.1.0)
- Increment package.json version
- Run `atris update` in test projects to verify sync functionality
- Ensure backward compatibility with existing generated artifacts

### When Adding New Commands
- Add to command routing in `bin/atris.js:16-24`
- Create new function following `initAtris()` and `syncAtris()` patterns
- Update help output in `bin/atris.js:8-13`
- Document in README.md if user-facing

## Design Principles

1. **Markdown as Interface** - All artifacts are markdown files for universal readability
2. **Exact References** - Always use file:line notation for precision
3. **Zero Dependencies** - CLI works with only Node.js standard library
4. **Folder Structure Contract** - `atris/` folder is the consistent pattern
5. **Agent-First Design** - Optimized for AI agent consumption and navigation
